package uk.nhs.interoperability.payloads.gui.model;

import static org.junit.Assert.*;

import org.junit.Test;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;

import uk.nhs.interoperability.payloads.Payload;
import uk.nhs.interoperability.payloads.templates.ChildPatientUniversal;
import uk.nhs.interoperability.payloads.toc_edischarge_draftB.ClinicalDocument;

public class PayloadObjectDeserialiserTest {

	private String testJson = "{\"name\":\"ClinicalDocument\",\"packg\":\"uk.nhs.interoperability.payloads.toc_edischarge_draftB\",\"fields\":[{\"name\":\"DocumentId\",\"xpath\":\"x:id/@root\",\"description\":\"A DCE UUID to identify this specific document and version\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"String\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"String\"},{\"name\":\"DocumentType\",\"xpath\":\"x:code\",\"description\":\"A SNOMED CT compositional grammar statement that describes both the type of document and the care setting it relates to.\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"CompositionalStatement\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"expectedExpressionCode\":\"810301000000103\",\"expectedExpressionDisplayName\":\"Clinical document descriptor (record artefact)\",\"typeEnum\":\"CompositionalStatement\"},{\"name\":\"DocumentTitle\",\"xpath\":\"x:title\",\"description\":\"A string which is rendered as a human readable title\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"String\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"String\"},{\"name\":\"EffectiveTime\",\"xpath\":\"x:effectiveTime/@value\",\"description\":\"The creation time of the CDA document\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"HL7Date\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"HL7Date\"},{\"vocabValues\":{\"vocabName\":\"x_BasicConfidentialityKind\",\"oid\":\"2.16.840.1.113883.1.11.16926\",\"entries\":[{\"code\":\"V\",\"displayName\":\"Very restricted\"},{\"code\":\"R\",\"displayName\":\"restricted\"},{\"code\":\"N\",\"displayName\":\"normal\"}]},\"name\":\"ConfidentialityCode\",\"xpath\":\"x:confidentialityCode\",\"mandatory\":true,\"addAtStart\":false,\"vocabulary\":\"x_BasicConfidentialityKind\",\"type\":\"CodedValue\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"localCodeOID\":\"2.16.840.1.113883.2.1.3.2.4.17.415\",\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"CodedValue\"},{\"name\":\"DocumentSetId\",\"xpath\":\"x:setId/@root\",\"description\":\"A DCE UUID to identify all documents that are part of a set of documents (i.e. previous versions of this document)\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"String\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"String\"},{\"name\":\"DocumentVersionNumber\",\"xpath\":\"x:versionNumber/@value\",\"description\":\"The version number of the document as an integer value\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"String\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"String\"},{\"name\":\"Patient\",\"xpath\":\"x:recordTarget/x:patientRole\",\"description\":\"Patient Details\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"PatientUniversalv2\",\"typePackage\":\"uk.nhs.interoperability.payloads.templates.\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"TimeAuthored\",\"xpath\":\"x:author/x:time/@value\",\"description\":\"The time the author originally recorded the End of life information\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"HL7Date\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"HL7Date\"},{\"name\":\"Author\",\"xpath\":\"x:author/x:assignedAuthor\",\"description\":\"The author of the End of Life care plan is the person who originally recorded the information on the End of Life system\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"Author\",\"typePackage\":\"uk.nhs.interoperability.payloads.templates.\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"versionedIdentifierXPath\":\"x:author/x:assignedAuthor/x:templateId/@extension\",\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Templated\"},{\"name\":\"DataEnterer\",\"xpath\":\"x:dataEnterer/x:assignedEntity\",\"description\":\"A data enterer is the person who entered the information contained in the document\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"PersonUniversal\",\"typePackage\":\"uk.nhs.interoperability.payloads.templates.\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"versionedIdentifierXPath\":\"x:dataEnterer/x:assignedEntity/x:templateId/@extension\",\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Templated\"},{\"name\":\"Informant\",\"xpath\":\"x:informant\",\"description\":\"A person who informed the author about information contained in the CDA document\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"DocumentInformant\",\"maxOccurs\":100,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"CustodianOrganisation\",\"xpath\":\"x:custodian/x:assignedCustodian\",\"description\":\"The organisation responsible for maintaining the information in the CDA document\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"CustodianOrganizationUniversal\",\"typePackage\":\"uk.nhs.interoperability.payloads.templates.\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"versionedIdentifierXPath\":\"x:custodian/x:assignedCustodian/x:templateId/@extension\",\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Templated\"},{\"name\":\"PrimaryRecipients\",\"xpath\":\"x:informationRecipient[@typeCode\u003d\u0027PRCP\u0027]\",\"description\":\"Primary recipients\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"PrimaryRecipient\",\"maxOccurs\":100,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"InformationOnlyRecipients\",\"xpath\":\"x:informationRecipient[@typeCode\u003d\u0027TRC\u0027]\",\"description\":\"Recipients who are sent a copy of the CDA document for information only. They are not normally required to carry out any action on receipt of the CDA document.\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"InformationOnlyRecipient\",\"maxOccurs\":100,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"TimeAuthenticated\",\"xpath\":\"x:authenticator/x:time/@value\",\"description\":\"When the person authenticated the CDA document\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"HL7Date\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"HL7Date\"},{\"name\":\"Authenticator\",\"xpath\":\"x:authenticator/x:assignedEntity\",\"description\":\"This is used where the CDA document needs to be authenticated. This means that the person who authenticated will have overall responsibility for the document not the author. For example a supervisor.\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"PersonUniversal\",\"typePackage\":\"uk.nhs.interoperability.payloads.templates.\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"versionedIdentifierXPath\":\"x:authenticator/x:assignedEntity/x:templateId/@extension\",\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Templated\"},{\"name\":\"Participant\",\"xpath\":\"x:participant\",\"description\":\"Participants are people, organisations or devices that are involved in some way with the CDA document.\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"DocumentParticipant\",\"maxOccurs\":100,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"DocumentationOf\",\"xpath\":\"x:documentationOf\",\"description\":\"This links the document header to the Service Event being documented in the CDA document\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"DocumentationOf\",\"maxOccurs\":100,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"AuthorizingConsent\",\"xpath\":\"x:authorization/x:consent\",\"description\":\"Details of consent/authorisation for the creation/sharing of the document\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"Consent\",\"typePackage\":\"uk.nhs.interoperability.payloads.templates.\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"versionedIdentifierXPath\":\"x:authorization/x:consent/x:templateId/@extension\",\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Templated\"},{\"name\":\"EncompassingEncounter\",\"xpath\":\"x:componentOf/x:encompassingEncounter\",\"description\":\"Used to link the document header to the EncompassingEncounter that the CDA document is documenting\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"EncompassingEncounter\",\"typePackage\":\"uk.nhs.interoperability.payloads.templates.\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"versionedIdentifierXPath\":\"x:componentOf/x:encompassingEncounter/x:templateId/@extension\",\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Templated\"},{\"name\":\"DocumentSections\",\"xpath\":\"x:component/x:structuredBody/x:component\",\"description\":\"A list of the text sections making up the document, linked with each PRSB heading\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"DocumentSection\",\"maxOccurs\":100,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"NonXMLBodyText\",\"xpath\":\"x:component/x:nonXMLBody/x:text\",\"description\":\"The information which makes up the document body when the standard CDA structure (mark-up) is not used.\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"String\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"String\"},{\"name\":\"NonXMLBodyMediaType\",\"xpath\":\"x:component/x:nonXMLBody/x:text/@mediaType\",\"description\":\"The mime type of the non-CDA body.\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"String\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"String\"},{\"name\":\"NonXMLBodyType\",\"description\":\"Encoding of non-CDA body - must be either TXT or B64. Please use the AttachmentType internal vocab.\",\"mandatory\":false,\"addAtStart\":false,\"vocabulary\":\"AttachmentType\",\"type\":\"String\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"String\"},{\"vocabValues\":{\"vocabName\":\"Documenttype\",\"oid\":\"2.16.840.1.113883.2.1.3.2.4.15\",\"entries\":[{\"code\":\"766781000000107\",\"displayName\":\"NHS Continuing Healthcare Checklist Assessment\"},{\"code\":\"958141000000101\",\"displayName\":\"BAAF C-infant report sent\"},{\"code\":\"313051000000108\",\"displayName\":\"Mental Health and Substance Misuse Specialist Services Models of Care Review Summary\"},{\"code\":\"715611000000100\",\"displayName\":\"Assessment Notification Accept Response Under Section 2 of the Community Care (Delayed Discharges etc) Act 2003\"},{\"code\":\"715651000000101\",\"displayName\":\"Discharge Notification Disagreement Under Section 5 of the Community Care (Delayed Discharges etc) Act 2003\"},{\"code\":\"313061000000106\",\"displayName\":\"Mental Health and Substance Misuse Specialist Services Unspecified Care Review Summary\"},{\"code\":\"313101000000108\",\"displayName\":\"Overview Assessment\"},{\"code\":\"163351000000104\",\"displayName\":\"Dietician Event\"},{\"code\":\"308375000\",\"displayName\":\"Report for Procurator-Fiscal\"},{\"code\":\"766801000000108\",\"displayName\":\"NHS Continuing Healthcare Request for Assessment\"},{\"code\":\"163451000000106\",\"displayName\":\"Mental Health Event\"},{\"code\":\"801581000000105\",\"displayName\":\"Outpatient Clinic Attendance - No Patient Copy Letter\"},{\"code\":\"371529009\",\"displayName\":\"History and physical report\"},{\"code\":\"184880006\",\"displayName\":\"Application to register disabled report\"},{\"code\":\"371538006\",\"displayName\":\"Advance directive report\"},{\"code\":\"163371000000108\",\"displayName\":\"Secondary Care Event\"},{\"code\":\"491831000000101\",\"displayName\":\"Personal Health Monitoring Report - Routine Scheduled\"},{\"code\":\"308584004\",\"displayName\":\"DLA 370 report\"},{\"code\":\"270358003\",\"displayName\":\"Life assurance - preliminary report\"},{\"code\":\"229059009\",\"displayName\":\"Report\"},{\"code\":\"371540001\",\"displayName\":\"Supervising physician report\"},{\"code\":\"163411000000107\",\"displayName\":\"Ward Attendance\"},{\"code\":\"163571000000101\",\"displayName\":\"Diagnostic Imaging Encounter\"},{\"code\":\"801551000000104\",\"displayName\":\"Outpatient Clinic Attendance - Patient Letter\"},{\"code\":\"185076008\",\"displayName\":\"BAAF C/D-adopt:child report\"},{\"code\":\"846951000000108\",\"displayName\":\"GP Referral\"},{\"code\":\"163481000000100\",\"displayName\":\"Discharge from Mental Health Services\"},{\"code\":\"305761000000107\",\"displayName\":\"Unseal Report\"},{\"code\":\"927081000000105\",\"displayName\":\"Lower gastrointestinal tract endoscopy report\"},{\"code\":\"196981000000101\",\"displayName\":\"General Practice Summary\"},{\"code\":\"715731000000103\",\"displayName\":\"Discharge Notification Under Section 5 of the Community Care (Delayed Discharges etc) Act 2003 Document\"},{\"code\":\"384101000000107\",\"displayName\":\"Telehealth Event\"},{\"code\":\"304391000000103\",\"displayName\":\"Statement of educational needs\"},{\"code\":\"193831000000104\",\"displayName\":\"Pathology Request Event\"},{\"code\":\"163301000000100\",\"displayName\":\"Physiotherapist Event\"},{\"code\":\"163511000000106\",\"displayName\":\"Prescription Cancel Request\"},{\"code\":\"313041000000105\",\"displayName\":\"Mental Health and Substance Misuse Specialist Services Care Programme Approach Review Summary\"},{\"code\":\"801561000000101\",\"displayName\":\"Outpatient Clinic Attendance - Maxillofacial and Tertiary Letter\"},{\"code\":\"801541000000102\",\"displayName\":\"Outpatient Clinic Attendance - GP Letter\"},{\"code\":\"461421000000103\",\"displayName\":\"BAAF B1 obstetric report\"},{\"code\":\"313091000000100\",\"displayName\":\"Contact Assessment\"},{\"code\":\"444804000\",\"displayName\":\"Multidisciplinary care conference report\"},{\"code\":\"918401000000103\",\"displayName\":\"Implanted device maintenance report\"},{\"code\":\"193841000000108\",\"displayName\":\"Pathology Report Event\"},{\"code\":\"859741000000101\",\"displayName\":\"Telehealth Referral\"},{\"code\":\"819541000000103\",\"displayName\":\"NHS 111 Event\"},{\"code\":\"422735006\",\"displayName\":\"Summary clinical document\"},{\"code\":\"305751000000109\",\"displayName\":\"Sealed Envelope Event\"},{\"code\":\"163391000000107\",\"displayName\":\"Discharge from Inpatient Care\"},{\"code\":\"312341000000104\",\"displayName\":\"Urgent Care Summary Report\"},{\"code\":\"766761000000103\",\"displayName\":\"NHS Continuing Healthcare Fast Track Pathway Tool\"},{\"code\":\"163311000000103\",\"displayName\":\"Occupational Therapist Event\"},{\"code\":\"307881004\",\"displayName\":\"DSS RMO RM2 report\"},{\"code\":\"163321000000109\",\"displayName\":\"Community Midwife Event\"},{\"code\":\"715661000000103\",\"displayName\":\"Cancellation Notification Under Section 3 of the Community Care (Delayed Discharges etc) Act 2003\"},{\"code\":\"163471000000102\",\"displayName\":\"Care Programme Approach Summary\"},{\"code\":\"846981000000102\",\"displayName\":\"GP Referral Reject Response\"},{\"code\":\"927071000000108\",\"displayName\":\"Upper gastrointestinal tract endoscopy report\"},{\"code\":\"371527006\",\"displayName\":\"Radiology report\"},{\"code\":\"491821000000103\",\"displayName\":\"Personal Health Monitoring Report - For Information Only\"},{\"code\":\"186065003\",\"displayName\":\"Power of attorney medical report\"},{\"code\":\"305771000000100\",\"displayName\":\"Seal Report\"},{\"code\":\"491811000000109\",\"displayName\":\"Personal Health Monitoring Report - Action Required\"},{\"code\":\"406550009\",\"displayName\":\"Summary of needs\"},{\"code\":\"163251000000107\",\"displayName\":\"FocusActOrEvent concept\"},{\"code\":\"163421000000101\",\"displayName\":\"Single Assessment Process Event\"},{\"code\":\"271452006\",\"displayName\":\"Solicitors report\"},{\"code\":\"859751000000103\",\"displayName\":\"Telehealth Clinician Response\"},{\"code\":\"861411000000103\",\"displayName\":\"End of Life Care Document\"},{\"code\":\"163581000000104\",\"displayName\":\"Diagnostic Imaging Report\"},{\"code\":\"371530004\",\"displayName\":\"Clinical consultation report\"},{\"code\":\"197391000000101\",\"displayName\":\"NHS Direct Event\"},{\"code\":\"828801000000101\",\"displayName\":\"NHS 111 Final Ambulance Request\"},{\"code\":\"766831000000102\",\"displayName\":\"NHS Continuing Healthcare Cancellation Notification\"},{\"code\":\"271531001\",\"displayName\":\"BAAF B1/2 - adoption: birth history\"},{\"code\":\"750021000000100\",\"displayName\":\"Integrated Care and Support Plan - Local Authority Joint Funded\"},{\"code\":\"185078009\",\"displayName\":\"BAAF D-child 2+yrs rep sent\"},{\"code\":\"371543004\",\"displayName\":\"Comprehensive history and physical report\"},{\"code\":\"766811000000105\",\"displayName\":\"NHS Continuing Healthcare Request for Assessment Acceptance\"},{\"code\":\"395641000000101\",\"displayName\":\"British Association for Adoption and Fostering B2 birth history report\"},{\"code\":\"163521000000100\",\"displayName\":\"Prescription Cancel Response\"},{\"code\":\"828791000000100\",\"displayName\":\"NHS 111 Interim Ambulance Request\"},{\"code\":\"371546007\",\"displayName\":\"Educational visit report\"},{\"code\":\"163501000000109\",\"displayName\":\"Prescription\"},{\"code\":\"861421000000109\",\"displayName\":\"End of Life Care Coordination Summary\"},{\"code\":\"313111000000105\",\"displayName\":\"Integrated Care and Support Plan\"},{\"code\":\"310854009\",\"displayName\":\"Housing report\"},{\"code\":\"184811000\",\"displayName\":\"NHS employee report - no examination\"},{\"code\":\"416700005\",\"displayName\":\"Written operative report\"},{\"code\":\"801601000000101\",\"displayName\":\"Outpatient Clinic Attendance - Administration Letter\"},{\"code\":\"270840000\",\"displayName\":\"Disabled drivers orange badge\"},{\"code\":\"308621001\",\"displayName\":\"RM10-DHSS DMO report\"},{\"code\":\"371524004\",\"displayName\":\"Clinical report\"},{\"code\":\"373942005\",\"displayName\":\"Discharge summary\"},{\"code\":\"185005006\",\"displayName\":\"Report from Health Visitor\"},{\"code\":\"766821000000104\",\"displayName\":\"NHS Continuing Healthcare Decision Support Tool\"},{\"code\":\"846961000000106\",\"displayName\":\"GP Referral Document\"},{\"code\":\"312991000000108\",\"displayName\":\"Mental Health Act Assessment Outside Specialist Services\"},{\"code\":\"801611000000104\",\"displayName\":\"Outpatient Clinic Attendance - Private Practice Letter\"},{\"code\":\"909021000000108\",\"displayName\":\"Safeguarding report\"},{\"code\":\"715721000000100\",\"displayName\":\"Assessment Notification Under Section 2 of the Community Care (Delayed Discharges etc) Act 2003 Document\"},{\"code\":\"829581000000103\",\"displayName\":\"Life insurance report\"},{\"code\":\"715591000000108\",\"displayName\":\"Hospital Discharge Notification to Social Care\"},{\"code\":\"766751000000101\",\"displayName\":\"NHS Continuing Healthcare\"},{\"code\":\"371525003\",\"displayName\":\"Clinical procedure report\"},{\"code\":\"423876004\",\"displayName\":\"Clinical document\"},{\"code\":\"163261000000105\",\"displayName\":\"Primary and Community Care Event\"},{\"code\":\"866371000000107\",\"displayName\":\"Child Screening Report\"},{\"code\":\"371526002\",\"displayName\":\"Operative report\"},{\"code\":\"270107007\",\"displayName\":\"Coroner\u0027s postmortem report\"},{\"code\":\"308619006\",\"displayName\":\"War pensions report\"},{\"code\":\"312711000000101\",\"displayName\":\"Ambulance Service Patient Summary Report\"},{\"code\":\"134188003\",\"displayName\":\"Statement of special educational needs\"},{\"code\":\"766791000000109\",\"displayName\":\"NHS Continuing Healthcare Checklist Assessment Acceptance\"},{\"code\":\"285101000000100\",\"displayName\":\"Refusal To Seal\"},{\"code\":\"715621000000106\",\"displayName\":\"Assessment Notification Reject Response Under Section 2 of the Community Care (Delayed Discharges etc) Act 2003\"},{\"code\":\"371545006\",\"displayName\":\"Confirmatory consultation report\"},{\"code\":\"270372007\",\"displayName\":\"Disabled driver orange badge report\"},{\"code\":\"313081000000102\",\"displayName\":\"Assessment Event\"},{\"code\":\"312421000000103\",\"displayName\":\"NHS Direct Summary Report\"},{\"code\":\"270389004\",\"displayName\":\"Mobility allowance claim representative\"},{\"code\":\"399345000\",\"displayName\":\"Adult echocardiography procedure report\"},{\"code\":\"193821000000101\",\"displayName\":\"Pathology Event\"},{\"code\":\"184882003\",\"displayName\":\"Disabled registration application - full report\"},{\"code\":\"313011000000109\",\"displayName\":\"Entry to Mental Health and Substance Misuse Specialist Services\"},{\"code\":\"914861000000106\",\"displayName\":\"ETT (exercise tolerance test) report\"},{\"code\":\"404187006\",\"displayName\":\"Statement of needs\"},{\"code\":\"163291000000104\",\"displayName\":\"District Nurse Event\"},{\"code\":\"308376004\",\"displayName\":\"Police surgeon postmortem report\"},{\"code\":\"185014001\",\"displayName\":\"Report to benefits agency\"},{\"code\":\"163491000000103\",\"displayName\":\"Medication Management Event\"},{\"code\":\"313277003\",\"displayName\":\"Adoption - birth history report\"},{\"code\":\"909041000000101\",\"displayName\":\"Child safeguarding report\"},{\"code\":\"717321000000108\",\"displayName\":\"Diagnostic imaging report\"},{\"code\":\"163361000000101\",\"displayName\":\"Out of Hours Event\"},{\"code\":\"270370004\",\"displayName\":\"Driving licence fitness report\"},{\"code\":\"384111000000109\",\"displayName\":\"Personal Health Monitoring Report\"},{\"code\":\"163431000000104\",\"displayName\":\"Single Assessment Process Contact Assessment\"},{\"code\":\"196971000000103\",\"displayName\":\"General Practice Initial Summary\"},{\"code\":\"270116006\",\"displayName\":\"Postmortem report\"},{\"code\":\"445042000\",\"displayName\":\"Hospital outpatient progress report\"},{\"code\":\"914851000000108\",\"displayName\":\"Ambulatory ECG (electrocardiography) monitoring report\"},{\"code\":\"184816005\",\"displayName\":\"Local authority employee - report\"},{\"code\":\"339561000000108\",\"displayName\":\"Withdrawal Notification\"},{\"code\":\"801571000000108\",\"displayName\":\"Outpatient Clinic Attendance - Results Letter\"},{\"code\":\"163541000000107\",\"displayName\":\"Dispensed Medication\"},{\"code\":\"270102001\",\"displayName\":\"Report for Coroner\"},{\"code\":\"320151000000108\",\"displayName\":\"Biographical Information\"},{\"code\":\"715681000000107\",\"displayName\":\"Cancellation of Section 5 Notification Under Section 3 of the Community Care (Delayed Discharges etc) Act 2003\"},{\"code\":\"697978002\",\"displayName\":\"Provider orders for life-sustaining treatment\"},{\"code\":\"184813002\",\"displayName\":\"Government department employee - report only\"},{\"code\":\"184881005\",\"displayName\":\"Disabled registration application - minimal report\"},{\"code\":\"163381000000105\",\"displayName\":\"Outpatient Clinic Attendance\"},{\"code\":\"371544005\",\"displayName\":\"Targeted history and physical report\"},{\"code\":\"163551000000105\",\"displayName\":\"Personally Administered Medication\"},{\"code\":\"715631000000108\",\"displayName\":\"Discharge Notification Under Section 5 of the Community Care (Delayed Discharges etc) Act 2003\"},{\"code\":\"766771000000105\",\"displayName\":\"NHS Continuing Healthcare Fast Track Pathway Tool Acceptance\"},{\"code\":\"750001000000109\",\"displayName\":\"Integrated Care and Support Plan - Continuing Health Care Funded\"},{\"code\":\"715601000000102\",\"displayName\":\"Assessment Notification Under Section 2 of the Community Care (Delayed Discharges etc) Act 2003\"},{\"code\":\"417185000\",\"displayName\":\"Dictated operative report\"},{\"code\":\"371539003\",\"displayName\":\"Conference report\"},{\"code\":\"313071000000104\",\"displayName\":\"Admission to Inpatient Care\"},{\"code\":\"184823006\",\"displayName\":\"Special activities med report\"},{\"code\":\"283281000000100\",\"displayName\":\"HealthSpace summary\"},{\"code\":\"163751000000100\",\"displayName\":\"Care Programme Approach summary\"},{\"code\":\"163331000000106\",\"displayName\":\"Health Visitor Event\"},{\"code\":\"181221000000100\",\"displayName\":\"Diagnostic Imaging Request Event - FocusActOrEvent\"},{\"code\":\"801591000000107\",\"displayName\":\"Outpatient Clinic Attendance - Safeguarded Letter\"},{\"code\":\"308575004\",\"displayName\":\"Employment report\"},{\"code\":\"163441000000108\",\"displayName\":\"Single Assessment Process Overview Assessment\"},{\"code\":\"308585003\",\"displayName\":\"DS 1500 report\"},{\"code\":\"313031000000101\",\"displayName\":\"Exit from Mental Health and Substance Misuse Specialist Services\"},{\"code\":\"371534008\",\"displayName\":\"Summary report\"},{\"code\":\"313021000000103\",\"displayName\":\"Update to Mental Health and Substance Misuse Specialist Services\"},{\"code\":\"270390008\",\"displayName\":\"BAAF Adult 1/2 - adoption: applicant report\"},{\"code\":\"909031000000105\",\"displayName\":\"Adult safeguarding report\"},{\"code\":\"163271000000103\",\"displayName\":\"General Practitioner Event\"},{\"code\":\"313141000000106\",\"displayName\":\"Mental Health and Substance Misuse Specialist Services Event\"},{\"code\":\"371532007\",\"displayName\":\"Progress report\"},{\"code\":\"308588001\",\"displayName\":\"BAAF C infant report\"},{\"code\":\"184850001\",\"displayName\":\"Insurance report - travel cancellation\"},{\"code\":\"163531000000103\",\"displayName\":\"Protocol Supply Medication\"},{\"code\":\"819551000000100\",\"displayName\":\"NHS 111 Report\"},{\"code\":\"184809009\",\"displayName\":\"Employment report - no examination\"},{\"code\":\"762391000000107\",\"displayName\":\"Cancer multidisciplinary team report\"},{\"code\":\"308589009\",\"displayName\":\"BAAF D-child 2+yrs report\"},{\"code\":\"185291000000100\",\"displayName\":\"Emergency Department Event\"},{\"code\":\"185301000000101\",\"displayName\":\"Minor Injuries Department Event\"},{\"code\":\"444754002\",\"displayName\":\"Hospital inpatient progress report\"},{\"code\":\"371535009\",\"displayName\":\"Transfer summary report\"},{\"code\":\"371536005\",\"displayName\":\"Flow sheet report\"},{\"code\":\"310601008\",\"displayName\":\"Report to Drug Safety Research Unit\"},{\"code\":\"371537001\",\"displayName\":\"Consent report\"},{\"code\":\"801531000000106\",\"displayName\":\"Outpatient Clinic Attendance - Consultant Referral Letter\"},{\"code\":\"846971000000104\",\"displayName\":\"GP Referral Accept Response\"},{\"code\":\"285091000000108\",\"displayName\":\"Nullification Document\"},{\"code\":\"768131000000105\",\"displayName\":\"NHS Continuing Healthcare Fast Track Pathway Tool Rejection\"},{\"code\":\"750031000000103\",\"displayName\":\"Integrated Care and Support Plan - Local Authority Only Funded\"},{\"code\":\"384121000000103\",\"displayName\":\"Out of Tolerance Notification\"},{\"code\":\"716371000000105\",\"displayName\":\"Diagnostic imaging summary report\"},{\"code\":\"184873009\",\"displayName\":\"Social security claim report\"},{\"code\":\"716061000000101\",\"displayName\":\"Diagnostic imaging procedure report\"},{\"code\":\"163341000000102\",\"displayName\":\"Chiropodist Event\"},{\"code\":\"371541002\",\"displayName\":\"Provider comment report\"},{\"code\":\"163401000000105\",\"displayName\":\"Discharge from Day Case Care\"},{\"code\":\"163461000000109\",\"displayName\":\"Entry to Mental Health Services\"},{\"code\":\"371531000\",\"displayName\":\"Encounter report\"},{\"code\":\"371542009\",\"displayName\":\"Admission history and physical report\"},{\"code\":\"163561000000108\",\"displayName\":\"Diagnostic Imaging Event\"},{\"code\":\"715641000000104\",\"displayName\":\"Discharge Notification Agreement Under Section 5 of the Community Care (Delayed Discharges etc) Act 2003\"},{\"code\":\"750011000000106\",\"displayName\":\"Integrated Care and Support Plan - Funded Nursing Care\"},{\"code\":\"163281000000101\",\"displayName\":\"Practice Nurse Event\"},{\"code\":\"768141000000101\",\"displayName\":\"NHS Continuing Healthcare Checklist Assessment Rejection\"},{\"code\":\"313001000000107\",\"displayName\":\"Update to Mental Health Act Assessment Non-Specialist Services\"},{\"code\":\"768151000000103\",\"displayName\":\"NHS Continuing Healthcare Request for Assessment Rejection\"},{\"code\":\"313121000000104\",\"displayName\":\"Specialist Assessment Outcome\"},{\"code\":\"185311000000104\",\"displayName\":\"Walk-in Centre Event\"}]},\"name\":\"PreviousDocumentType\",\"xpath\":\"x:relatedDocument/x:priorParentDocument/x:code\",\"mandatory\":true,\"addAtStart\":false,\"vocabulary\":\"Documenttype\",\"type\":\"CodedValue\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"localCodeOID\":\"2.16.840.1.113883.2.1.3.2.4.17.337\",\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"CodedValue\"},{\"name\":\"PreviousDocumentVersionID\",\"xpath\":\"x:relatedDocument/x:priorParentDocument/x:id\",\"description\":\"A DCE UUID that identifies the specific document and version that this document replaces\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"String\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"String\"},{\"name\":\"PreviousDocumentVersionSetId\",\"xpath\":\"x:relatedDocument/x:priorParentDocument/x:setId\",\"description\":\"A DCE UUID that identifies the document set of the document that this document replaces (should always match the document set of this document)\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"String\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"String\"},{\"name\":\"PreviousDocumentVersionNumber\",\"xpath\":\"x:relatedDocument/x:priorParentDocument/x:versionNumber\",\"description\":\"An integer value that identifies the version number of the document that this document replaces\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"String\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"String\"}],\"payload\":{\"DocumentId\":\"1234\",\"PreviousDocumentVersionNumber\":\"1\",\"DocumentVersionNumber\":\"2\"}}";
	private String testJsonFromClient = "{\"name\":\"ClinicalDocument\",\"packg\":\"uk.nhs.interoperability.payloads.toc_edischarge_draftB\",\"payload\":{\"DocumentId\":\"1234\",\"PreviousDocumentVersionNumber\":\"1\",\"DocumentVersionNumber\":\"2\"}}";
	private String testJsonWithCodedValue = "{\"name\":\"ChildPatientUniversal\",\"packg\":\"uk.nhs.interoperability.payloads.templates\",\"fields\":[{\"name\":\"PatientID\",\"xpath\":\"x:id\",\"description\":\"There must be either one or two instances of PatientId. The first instance of id must contain information related to the patient\u0027s NHS Number. The second instance of id may contain information related to a local patient identifier.\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"PatientIDWithTraceStatuses\",\"typePackage\":\"uk.nhs.interoperability.payloads.commontypes.\",\"maxOccurs\":2,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"Address\",\"xpath\":\"x:addr\",\"description\":\"A set of addresses for the patient (this is limited to a maximum of 4 types to reduce display issues in rendering CDA documents)\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"Address\",\"typePackage\":\"uk.nhs.interoperability.payloads.commontypes.\",\"maxOccurs\":4,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"Name\",\"xpath\":\"x:patient/x:name\",\"description\":\"Patient\u0027s name\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"PersonName\",\"typePackage\":\"uk.nhs.interoperability.payloads.commontypes.\",\"maxOccurs\":4,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"vocabValues\":{\"vocabName\":\"Sex\",\"oid\":\"2.16.840.1.113883.2.1.3.2.4.16.25\",\"entries\":[{\"code\":\"2\",\"displayName\":\"Female\"},{\"code\":\"1\",\"displayName\":\"Male\"},{\"code\":\"0\",\"displayName\":\"Not known\"},{\"code\":\"9\",\"displayName\":\"Not specified\"}]},\"name\":\"Gender\",\"xpath\":\"x:patient/x:administrativeGenderCode\",\"description\":\"This code is for administrative purposes only and does not imply a particular genetic or physical sex\",\"mandatory\":true,\"addAtStart\":false,\"vocabulary\":\"Sex\",\"type\":\"CodedValue\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"CodedValue\"},{\"name\":\"DateOfBirth\",\"xpath\":\"x:patient/x:birthTime/@value\",\"description\":\"The patient\u0027s date of birth\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"HL7Date\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"HL7Date\"},{\"name\":\"Guardian\",\"xpath\":\"x:patient/x:guardian\",\"description\":\"The person or organisation who/which is or acts as the patient\u0027s guardian.\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"ChildPatientGuardian\",\"maxOccurs\":100,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"OrganisationId\",\"xpath\":\"x:providerOrganization/x:id\",\"description\":\"An ODS code as an identifier that uniquely identifies the organisation which provides/provided care to the patient\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"OrgID\",\"typePackage\":\"uk.nhs.interoperability.payloads.commontypes.\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"OrganisationName\",\"xpath\":\"x:providerOrganization/x:name\",\"description\":\"The description of the organisation associated with the ODS code\",\"mandatory\":true,\"addAtStart\":false,\"type\":\"String\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"String\"},{\"name\":\"OrganisationTelephone\",\"xpath\":\"x:providerOrganization/x:telecom\",\"description\":\"Telephone Number of the organisation\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"Telecom\",\"typePackage\":\"uk.nhs.interoperability.payloads.commontypes.\",\"maxOccurs\":4,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"name\":\"OrganisationAddress\",\"xpath\":\"x:providerOrganization/x:addr\",\"description\":\"A contact address for the organisation\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"Address\",\"typePackage\":\"uk.nhs.interoperability.payloads.commontypes.\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"},{\"vocabValues\":{\"vocabName\":\"CDAOrganizationProviderType\",\"oid\":\"2.16.840.1.113883.2.1.3.2.4.17.289\",\"entries\":[{\"code\":\"001\",\"displayName\":\"GP Practice\"}]},\"name\":\"OrganisationType\",\"xpath\":\"x:providerOrganization/x:standardIndustryClassCode\",\"description\":\"A code taken from the CDAOrganizationProviderType vocabulary to indicate the type of care provider\",\"mandatory\":true,\"addAtStart\":false,\"vocabulary\":\"CDAOrganizationProviderType\",\"type\":\"CodedValue\",\"maxOccurs\":1,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"CodedValue\"},{\"name\":\"OrganisationPartOf\",\"xpath\":\"x:providerOrganization/x:asOrganizationPartOf\",\"description\":\"Information about the organisation the provider organisation is part of\",\"mandatory\":false,\"addAtStart\":false,\"type\":\"ChildPatientOrganisationPartOf\",\"maxOccurs\":100,\"isDuplicateXPath\":false,\"suppressCodeSystem\":false,\"suppressDisplayName\":false,\"typeEnum\":\"Other\"}],\"payload\":{\"Gender\":{\"code\":\"2\",\"displayName\":\"Female\",\"oid\":\"2.16.840.1.113883.2.1.3.2.4.16.25\"}}}";
	
	@Test
	public void testDeserialisePayload() {
		ClinicalDocument deserialised = (ClinicalDocument)deserialise(testJson);
		System.out.println("Payload: " + deserialised.toString());
		assertEquals(deserialised.getDocumentId(), "1234");
		assertEquals(deserialised.getDocumentVersionNumber(), "2");
		assertEquals(deserialised.getPreviousDocumentVersionNumber(), "1");
	}
	
	@Test
	public void testDeserialisePayloadFromClient() {
		ClinicalDocument deserialised = (ClinicalDocument)deserialise(testJsonFromClient);
		System.out.println("Payload: " + deserialised.toString());
		assertEquals(deserialised.getDocumentId(), "1234");
		assertEquals(deserialised.getDocumentVersionNumber(), "2");
		assertEquals(deserialised.getPreviousDocumentVersionNumber(), "1");
	}
	
	@Test
	public void testDeserialisePayloadWithCodedValue() {
		ChildPatientUniversal deserialised = (ChildPatientUniversal)deserialise(testJsonWithCodedValue);
		System.out.println("Payload: " + deserialised.toString());
		assertEquals(deserialised.getGender().getCode(), "2");
	}

	
	private Payload deserialise(String json) {
		GsonBuilder gsonBuilder = new GsonBuilder();
		gsonBuilder.registerTypeAdapter(Payload.class, new PayloadObjectDeserialiser());
		Gson gson = gsonBuilder.create();
		System.out.println("Deserialising JSON: " + json);
		return gson.fromJson(json, Payload.class);
	}

}
